<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('partials/head') %>
</head>

<body class="container">

  <header>
    <%- include('partials/header') %>
  </header>

  <main>
    <p>Enter a new password.</p>
    <form id="pwd-form">
      <input type="password" placeholder="password" id="password" required>
      <input type="password" placeholder="confirm password" id="confirmPassword" required>
      </br><input type="submit">Submit</button>
    </form>

    <h2 id="warning"></h2>

    <script>
      const form = document.getElementById('pwd-form')
      form.addEventListener('submit', changePwd)

      async function changePwd(event) {
        event.preventDefault()

        const password = document.getElementById('password').value
        const confirmpassword = document.getElementById('confirmPassword').value

        if (password !== confirmpassword) {
          document.getElementById("warning").innerHTML = "passwords do not match.";
        } else {

          const result = await fetch('/change-password', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              newpassword: password,
              token: localStorage.getItem('token')
            })
          }).then((res) => res.json())

          if (result.status === 'ok') {
            //everything went ok 
            document.getElementById("warning").innerHTML = "Success, your password has been update.";
          } else {
            document.getElementById("success").innerHTML = "PASSWORD UPDATE FAILED: " + result.error;

          }
          console.log(result)
        }
      }
    </script>

  </main>


  <%- include('partials/footer') %>